<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ—Ç–∏–∫–æ–≤ ‚Äî –ö–æ—Ç–æ—Ñ–∞–±—Ä–∏–∫–∞</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
</head>
<body class="app builder-page">
    <header class="app-header">
        <div class="container app-header__inner">
            <a class="brand" href="{% url 'catalog' %}"><span class="brand-icon">üêæ</span>–ö–æ—Ç–æ—Ñ–∞–±—Ä–∏–∫–∞</a>
            <nav class="app-header__nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
                <a class="app-header__link" href="{% url 'catalog' %}">–ö–∞—Ç–∞–ª–æ–≥</a>
                <a class="app-header__link" href="{% url 'orders' %}">–ó–∞–∫–∞–∑—ã</a>
            </nav>
            <div class="app-header__actions">
                <a class="secondary-btn secondary-btn--active" href="{% url 'builder' %}">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</a>
                <a class="ghost-btn" href="{% url 'cart' %}" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">üõí</a>
                <a class="ghost-btn" href="{% url 'profile' %}" aria-label="–ü—Ä–æ—Ñ–∏–ª—å">üë§</a>
            </div>
        </div>
    </header>

    <main>
        <section class="section">
            <div class="container builder-shell">
                <div class="builder-intro">
                    <h1 class="builder-title">
                        {% if user.is_authenticated %}
                        –°–æ–±–µ—Ä–∏—Ç–µ –∫–æ—Ç–∏–∫–∞ –∏–∑ –ª—é–±–∏–º—ã—Ö –¥–µ—Ç–∞–ª–µ–π!
                        {% else %}
                        –°–æ–±–µ—Ä–∏—Ç–µ –∫–æ—Ç–∏–∫–∞ –∏–∑ –ª—é–±–∏–º—ã—Ö –¥–µ—Ç–∞–ª–µ–π
                        {% endif %}
                    </h1>
                    <p class="builder-description text-muted">
                        –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ –≥–æ–ª–æ–≤—É –∏ —Ç–µ–ª–æ —Å—Ç—Ä–µ–ª–∫–∞–º–∏, —á—Ç–æ–±—ã –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è. –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–≤–µ—Ä—Ö—É –æ—Å—Ç–∞—ë—Ç—Å—è
                        –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π ‚Äî —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å –æ–±—Ä–∞–∑–∞–º–∏ –ø—Ä—è–º–æ –∑–¥–µ—Å—å, –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫.
                    </p>
                    <div class="builder-actions">
                        <button class="secondary-btn" onclick="saveCat()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ—Ç–∏–∫–∞</button>
                    </div>
                </div>

                <div class="cat-builder" aria-label="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ—Ç–∏–∫–∞">
                    <div class="cat-stage" role="img" aria-label="–í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ç–∏–∫–∞">
                        <button class="arrow-btn head-arrow arrow-btn--left" type="button" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∞—è –≥–æ–ª–æ–≤–∞">
                            &#8249;
                        </button>
                        <button class="arrow-btn head-arrow arrow-btn--right" type="button" aria-label="–°–ª–µ–¥—É—é—â–∞—è –≥–æ–ª–æ–≤–∞">
                            &#8250;
                        </button>

                        <button class="arrow-btn body-arrow arrow-btn--left" type="button" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Ç–µ–ª–æ">
                            &#8249;
                        </button>
                        <button class="arrow-btn body-arrow arrow-btn--right" type="button" aria-label="–°–ª–µ–¥—É—é—â–µ–µ —Ç–µ–ª–æ">
                            &#8250;
                        </button>

                        <div class="cat-canvas">
                            <img
                                id="cat-body"
                                class="cat-layer cat-body"
                                src="{% static 'images/body-1.png' %}"
                                alt="–¢–µ–ª–æ –∫–æ—Ç–∏–∫–∞"
                            />
                            <img
                                id="cat-head"
                                class="cat-layer cat-head"
                                src="{% static 'images/head-1.png' %}"
                                alt="–ì–æ–ª–æ–≤–∞ –∫–æ—Ç–∏–∫–∞"
                            />
                        </div>
                    </div>

                    <div class="builder-note">
                        <p>
                            {% if user.is_authenticated %}
                            –ü–æ–¥–±–∏—Ä–∞–π—Ç–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è, –ø–æ–∫–∞ –∫–æ—Ç–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–º. –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–µ—Å–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ.
                            {% else %}
                            –ü–æ–¥–±–∏—Ä–∞–π—Ç–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è, –ø–æ–∫–∞ –∫–æ—Ç–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–º. –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
                            {% endif %}
                        </p>
                        <div class="current-selection">
                            <p><strong>–¢–µ–∫—É—â–∞—è –≥–æ–ª–æ–≤–∞:</strong> <span id="current-head">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≥–æ–ª–æ–≤–∞ (1/7)</span></p>
                            <p><strong>–¢–µ–∫—É—â–µ–µ —Ç–µ–ª–æ:</strong> <span id="current-body">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ç–µ–ª–æ (1/6)</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="{% static 'java/main.js' %}"></script>
    <script>
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏ Django
        const heads = [
            "{% static 'images/head-1.png' %}",
            "{% static 'images/head-2.png' %}",
            "{% static 'images/head-3.png' %}",
            "{% static 'images/head-4.png' %}",
            "{% static 'images/head-5.png' %}",
            "{% static 'images/head-6.png' %}",
            "{% static 'images/head-7.png' %}"
        ];

        const bodies = [
            "{% static 'images/body-1.png' %}",
            "{% static 'images/body-2.png' %}",
            "{% static 'images/body-3.png' %}",
            "{% static 'images/body-4.png' %}",
            "{% static 'images/body-5.png' %}",
            "{% static 'images/body-6.png' %}"
        ];

        // –ù–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const headNames = [
            "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≥–æ–ª–æ–≤–∞", "–†–∞–¥—É–∂–Ω–∞—è –≥–æ–ª–æ–≤–∞", "–û–≥–Ω–µ–Ω–Ω–∞—è –≥–æ–ª–æ–≤–∞",
            "–¢–∏–≥—Ä–∏–Ω–∞—è –≥–æ–ª–æ–≤–∞", "–ì–æ–ª–æ–≤–∞ –†–æ–±–∏–Ω –ì—É–¥–∞", "–ì–æ–ª–æ–≤–∞ –î—Ä–∏–∞–¥—ã", "–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∞—è –≥–æ–ª–æ–≤–∞"
        ];

        const bodyNames = [
            "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ç–µ–ª–æ", "–¢–µ–ª–æ '–î—É—ç—Ç'", "–ù–æ—á–Ω–æ–µ —Ç–µ–ª–æ",
            "–°–Ω–µ–∂–Ω–æ–µ —Ç–µ–ª–æ", "–ü—É—Ö–ª–æ–µ —Ç–µ–ª–æ", "–†–∞–¥—É–∂–Ω–æ–µ —Ç–µ–ª–æ"
        ];

        let headIndex = 0;
        let bodyIndex = 0;

        function updateHead() {
            document.getElementById("cat-head").src = heads[headIndex];
            document.getElementById("current-head").textContent =
                `${headNames[headIndex]} (${headIndex + 1}/${heads.length})`;
        }

        function updateBody() {
            document.getElementById("cat-body").src = bodies[bodyIndex];
            document.getElementById("current-body").textContent =
                `${bodyNames[bodyIndex]} (${bodyIndex + 1}/${bodies.length})`;
        }

        function nextHead() {
            headIndex = (headIndex + 1) % heads.length;
            updateHead();
        }

        function prevHead() {
            headIndex = (headIndex - 1 + heads.length) % heads.length;
            updateHead();
        }

        function nextBody() {
            bodyIndex = (bodyIndex + 1) % bodies.length;
            updateBody();
        }

        function prevBody() {
            bodyIndex = (bodyIndex - 1 + bodies.length) % bodies.length;
            updateBody();
        }

        function saveCat() {
            const catData = {
                head: headIndex,
                body: bodyIndex,
                headName: headNames[headIndex],
                bodyName: bodyNames[bodyIndex],
                timestamp: new Date().toISOString()
            };

            // –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            alert(`–ö–æ—Ç–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!\n–ì–æ–ª–æ–≤–∞: ${catData.headName}\n–¢–µ–ª–æ: ${catData.bodyName}\n\n–í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.`);

            // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
            localStorage.setItem('lastSavedCat', JSON.stringify(catData));
        }

        function bindArrows() {
            document.querySelector('.head-arrow.arrow-btn--left')?.addEventListener('click', prevHead);
            document.querySelector('.head-arrow.arrow-btn--right')?.addEventListener('click', nextHead);
            document.querySelector('.body-arrow.arrow-btn--left')?.addEventListener('click', prevBody);
            document.querySelector('.body-arrow.arrow-btn--right')?.addEventListener('click', nextBody);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        bindArrows();
        updateHead();
        updateBody();

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –∫–æ—Ç–∏–∫–∞
        document.addEventListener('DOMContentLoaded', function() {
            const savedCat = localStorage.getItem('lastSavedCat');
            if (savedCat) {
                const catData = JSON.parse(savedCat);
                headIndex = catData.head;
                bodyIndex = catData.body;
                updateHead();
                updateBody();
            }
        });
    </script>
</body>
</html>