<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Äî –ö–æ—Ç–æ—Ñ–∞–±—Ä–∏–∫–∞</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
  </head>
  <body class="app">
    <header class="app-header">
      <div class="container app-header__inner">
        <a class="brand" href="{% url 'home' %}"><span class="brand-icon">üêæ</span>–ö–æ—Ç–æ—Ñ–∞–±—Ä–∏–∫–∞</a>
        <nav class="app-header__nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
          <a class="app-header__link" href="{% url 'catalog' %}">–ö–∞—Ç–∞–ª–æ–≥</a>
        </nav>
        <div class="app-header__actions">
          <a class="secondary-btn" href="{% url 'builder' %}">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</a>
          <a class="ghost-btn" href="{% url 'cart' %}" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">üõí</a>
          <a class="ghost-btn" href="{% url 'profile' %}" aria-label="–ü—Ä–æ—Ñ–∏–ª—å">üë§</a>
        </div>
      </div>
    </header>

    <main class="section">
      <div class="container">

        <!-- –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞–ª–æ –¥–µ–Ω–µ–≥) -->
        {% if messages %}
            {% for message in messages %}
                <div style="padding: 15px; margin-bottom: 20px; border-radius: 8px; background: #ffe6e6; color: #d00; border: 1px solid #d00;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <span class="tag">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</span>
        <h2>–ü–æ–∫—É–ø–∫–∞ —á–∞—Å—Ç–µ–π</h2>
        <div class="split-layout" style="margin-top:28px;">

          <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞ -->
          <form class="panel" style="gap:20px;" method="post">
            {% csrf_token %}
            <h3>–î–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h3>
            <label class="form-group">
              <span>–ò–º—è</span>
              <input type="text" name="name" value="{{ user.first_name|default:user.username }}" readonly style="opacity: 0.7;" />
            </label>
            <label class="form-group">
              <span>Email</span>
              <input type="email" name="email" value="{{ user.email|default:'–ù–µ—Ç –ø–æ—á—Ç—ã' }}" readonly style="opacity: 0.7;" />
            </label>

            <h3>–û–ø–ª–∞—Ç–∞</h3>
            <p style="font-size: 0.9em; color: #666;">–°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç —Å–ø–∏—Å–∞–Ω—ã —Å –≤–∞—à–µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞.</p>
            <label class="form-group">
              <span>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</span>
              <select name="payment_method">
                <option value="balance">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å ({{ profile.balance }} ‚ÇΩ)</option>
              </select>
            </label>

            <!-- –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –¥–µ–Ω–µ–≥ –º–∞–ª–æ -->
            {% if profile.balance >= total_price %}
                <button class="primary-btn" type="submit">–û–ø–ª–∞—Ç–∏—Ç—å {{ total_price }} ‚ÇΩ</button>
            {% else %}
                <button class="primary-btn" type="button" disabled style="opacity: 0.5; cursor: not-allowed;">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</button>
                <p style="color: red; font-size: 0.9em;">–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤ –ø—Ä–æ—Ñ–∏–ª–µ (–Ω—É–∂–Ω–æ {{ total_price }} ‚ÇΩ).</p>
            {% endif %}
          </form>

          <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ -->
          <aside class="panel" style="align-self:start;">
            <h3>–í –∑–∞–∫–∞–∑–µ</h3>
            <div class="checkout-list" style="margin-top:20px;">
              {% for item in cart_items %}
              <div class="checkout-item">
                <img class="checkout-thumb" src="{{ item.part.image.url }}" alt="{{ item.part.name }}" />
                <div>
                  <h4>{{ item.part.name }}</h4>
                  <p class="text-muted">{{ item.part.price }} ‚ÇΩ</p>
                </div>
              </div>
              {% endfor %}
            </div>
            <div class="checkout-summary">
              <div class="checkout-summary__total"><span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</span><span>{{ total_price }} ‚ÇΩ</span></div>
            </div>
          </aside>
        </div>
      </div>
    </main>

    <script src="{% static 'java/main.js' %}"></script>
  </body>
</html>